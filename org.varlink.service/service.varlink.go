// This file was automatically generated by snai.pe/go-varlink/codegen
// DO NOT EDIT

// The Varlink Service Interface is provided by every varlink service. It
// describes the service and the interfaces it implements.
package service

import (
	"context"
	"encoding/json"
	"fmt"

	"snai.pe/go-varlink"

	"snai.pe/go-varlink/syntax"
)

var _ = fmt.Errorf
var _ = json.RawMessage(nil)
var _ = context.Background

// InterfaceName is the fully-qualified name of this varlink interface.
const InterfaceName = `org.varlink.service`

// Input parameters for GetInfo method.
//
// You shouldn't have to use this type directly; it is only useful if you
// need to manually send method calls. Instead, use the methods of the
// Client type.
type GetInfoInput struct{}

// Output parameters for GetInfo method.
//
// You shouldn't have to use this type directly; it is only useful if you
// need to manually send method calls. Instead, use the methods of the
// Client type.
type GetInfoOutput struct {
	Vendor     string   `json:"vendor"`
	Product    string   `json:"product"`
	Version    string   `json:"version"`
	Url        string   `json:"url"`
	Interfaces []string `json:"interfaces"`
}

// Pack fills in the fields of GetInfoOutput from a
// parameter list.
func (output_ *GetInfoOutput) Pack(vendor string, product string, version string, url string, interfaces []string) {
	output_.Vendor = vendor
	output_.Product = product
	output_.Version = version
	output_.Url = url
	output_.Interfaces = interfaces
}

// Unpack unpacks the fields of GetInfoInput to a
// parameter list.
func (output_ *GetInfoOutput) Unpack() (vendor string, product string, version string, url string, interfaces []string) {
	vendor = output_.Vendor
	product = output_.Product
	version = output_.Version
	url = output_.Url
	interfaces = output_.Interfaces
	return
}

// Input parameters for GetInterfaceDescription method.
//
// You shouldn't have to use this type directly; it is only useful if you
// need to manually send method calls. Instead, use the methods of the
// Client type.
type GetInterfaceDescriptionInput struct {
	Interface string `json:"interface"`
}

// Pack fills in the fields of GetInterfaceDescriptionInput from a
// parameter list.
func (input_ *GetInterfaceDescriptionInput) Pack(interface_ string) {
	input_.Interface = interface_
}

// Unpack unpacks the fields of GetInterfaceDescriptionInput to a
// parameter list.
func (input_ *GetInterfaceDescriptionInput) Unpack() (interface_ string) {
	interface_ = input_.Interface
	return
}

// Output parameters for GetInterfaceDescription method.
//
// You shouldn't have to use this type directly; it is only useful if you
// need to manually send method calls. Instead, use the methods of the
// Client type.
type GetInterfaceDescriptionOutput struct {
	Description string `json:"description"`
}

// Pack fills in the fields of GetInterfaceDescriptionOutput from a
// parameter list.
func (output_ *GetInterfaceDescriptionOutput) Pack(description string) {
	output_.Description = description
}

// Unpack unpacks the fields of GetInterfaceDescriptionInput to a
// parameter list.
func (output_ *GetInterfaceDescriptionOutput) Unpack() (description string) {
	description = output_.Description
	return
}

// The requested interface was not found.
type InterfaceNotFoundError struct {
	Interface string `json:"interface"`
}

func (InterfaceNotFoundError) ErrorCode() string {
	return `org.varlink.service.InterfaceNotFound`
}

func (InterfaceNotFoundError) Error() string {
	return `The requested interface was not found.`
}

func InterfaceNotFound(interface_ string) InterfaceNotFoundError {
	var err_ InterfaceNotFoundError
	err_.Interface = interface_
	return err_
}

// The requested method was not found
type MethodNotFoundError struct {
	Method string `json:"method"`
}

func (MethodNotFoundError) ErrorCode() string {
	return `org.varlink.service.MethodNotFound`
}

func (MethodNotFoundError) Error() string {
	return `The requested method was not found`
}

func MethodNotFound(method string) MethodNotFoundError {
	var err_ MethodNotFoundError
	err_.Method = method
	return err_
}

// The interface defines the requested method, but the service does not
// implement it.
type MethodNotImplementedError struct {
	Method string `json:"method"`
}

func (MethodNotImplementedError) ErrorCode() string {
	return `org.varlink.service.MethodNotImplemented`
}

func (MethodNotImplementedError) Error() string {
	return `The interface defines the requested method, but the service does not implement it.`
}

func MethodNotImplemented(method string) MethodNotImplementedError {
	var err_ MethodNotImplementedError
	err_.Method = method
	return err_
}

// One of the passed parameters is invalid.
type InvalidParameterError struct {
	Parameter string `json:"parameter"`
}

func (InvalidParameterError) ErrorCode() string {
	return `org.varlink.service.InvalidParameter`
}

func (InvalidParameterError) Error() string {
	return `One of the passed parameters is invalid.`
}

func InvalidParameter(parameter string) InvalidParameterError {
	var err_ InvalidParameterError
	err_.Parameter = parameter
	return err_
}

// Client is denied access
type PermissionDeniedError struct{}

func (PermissionDeniedError) ErrorCode() string {
	return `org.varlink.service.PermissionDenied`
}

func (PermissionDeniedError) Error() string {
	return `Client is denied access`
}

func PermissionDenied() PermissionDeniedError {
	var err_ PermissionDeniedError
	return err_
}

// Method is expected to be called with 'more' set to true, but wasn't
type ExpectedMoreError struct{}

func (ExpectedMoreError) ErrorCode() string {
	return `org.varlink.service.ExpectedMore`
}

func (ExpectedMoreError) Error() string {
	return `Method is expected to be called with 'more' set to true, but wasn't`
}

func ExpectedMore() ExpectedMoreError {
	var err_ ExpectedMoreError
	return err_
}

// Client represents a varlink client that implements the org.varlink.service
// interface.
type Client struct {
	varlink.Client
}

// ErrorFromCode returns a new varlink error constructed from the specified
// code and parameters.
func ErrorFromCode(code string, params json.RawMessage) varlink.Error {
	switch code {
	case `org.varlink.service.InterfaceNotFound`:
		var err_ InterfaceNotFoundError
		if err2_ := json.Unmarshal([]byte(params), &err_); err2_ != nil {
			panic(`programming error: org.varlink.service.InterfaceNotFound params is invalid json: ` + err2_.Error())
		}
		return err_

	case `org.varlink.service.MethodNotFound`:
		var err_ MethodNotFoundError
		if err2_ := json.Unmarshal([]byte(params), &err_); err2_ != nil {
			panic(`programming error: org.varlink.service.MethodNotFound params is invalid json: ` + err2_.Error())
		}
		return err_

	case `org.varlink.service.MethodNotImplemented`:
		var err_ MethodNotImplementedError
		if err2_ := json.Unmarshal([]byte(params), &err_); err2_ != nil {
			panic(`programming error: org.varlink.service.MethodNotImplemented params is invalid json: ` + err2_.Error())
		}
		return err_

	case `org.varlink.service.InvalidParameter`:
		var err_ InvalidParameterError
		if err2_ := json.Unmarshal([]byte(params), &err_); err2_ != nil {
			panic(`programming error: org.varlink.service.InvalidParameter params is invalid json: ` + err2_.Error())
		}
		return err_

	case `org.varlink.service.PermissionDenied`:
		var err_ PermissionDeniedError
		if err2_ := json.Unmarshal([]byte(params), &err_); err2_ != nil {
			panic(`programming error: org.varlink.service.PermissionDenied params is invalid json: ` + err2_.Error())
		}
		return err_

	case `org.varlink.service.ExpectedMore`:
		var err_ ExpectedMoreError
		if err2_ := json.Unmarshal([]byte(params), &err_); err2_ != nil {
			panic(`programming error: org.varlink.service.ExpectedMore params is invalid json: ` + err2_.Error())
		}
		return err_
	default:
		var kvargs []any
		var pmap map[string]any
		if err2_ := json.Unmarshal([]byte(params), &pmap); err2_ != nil {
			panic(`programming error: ` + code + ` params is invalid json: ` + err2_.Error())
		}
		for k, v := range pmap {
			kvargs = append(kvargs, k, v)
		}
		return varlink.NewError(code, kvargs...)
	}
}

// Get a list of all the interfaces a service provides and information
// about the implementation.
func (client_ *Client) GetInfo(ctx context.Context) (vendor string, product string, version string, url string, interfaces []string, err_ error) {
	var (
		input_  GetInfoInput
		output_ GetInfoOutput
	)

	rs, err := client_.Call(ctx, `org.varlink.service.GetInfo`, &input_)
	if err != nil {
		err_ = err
		return
	}

	for rs.Next() {
		r := rs.Reply()
		if r.Error != "" {
			err_ = ErrorFromCode(r.Error, r.Parameters)
			return
		}
		if r.Continues {
			err_ = fmt.Errorf("more than one reply on single-reply call")
			return
		}

		if err := rs.Unmarshal(&output_); err != nil {
			err_ = err
			return
		}
	}
	if err := rs.Error(); err != nil {
		err_ = err
		return
	}

	vendor, product, version, url, interfaces = output_.Unpack()
	return
}

// Get the description of an interface that is implemented by this service.
func (client_ *Client) GetInterfaceDescription(ctx context.Context, interface_ string) (description string, err_ error) {
	var (
		input_  GetInterfaceDescriptionInput
		output_ GetInterfaceDescriptionOutput
	)

	input_.Pack(interface_)

	rs, err := client_.Call(ctx, `org.varlink.service.GetInterfaceDescription`, &input_)
	if err != nil {
		err_ = err
		return
	}

	for rs.Next() {
		r := rs.Reply()
		if r.Error != "" {
			err_ = ErrorFromCode(r.Error, r.Parameters)
			return
		}
		if r.Continues {
			err_ = fmt.Errorf("more than one reply on single-reply call")
			return
		}

		if err := rs.Unmarshal(&output_); err != nil {
			err_ = err
			return
		}
	}
	if err := rs.Error(); err != nil {
		err_ = err
		return
	}

	description = output_.Unpack()
	return
}

// Service is the interface that servers that implement the org.varlink.service
// varlink interface must adhere to.
type Service interface {

	// Get a list of all the interfaces a service provides and information
	// about the implementation.
	GetInfo(ctx context.Context) (vendor string, product string, version string, url string, interfaces []string, err_ varlink.Error)

	// Get the description of an interface that is implemented by this service.
	GetInterfaceDescription(ctx context.Context, interface_ string) (description string, err_ varlink.Error)
}

// NewHandler creates a new method handler for the specified service implementation.
func NewHandler(s Service) varlink.MethodHandler {
	var mux varlink.ServeMux
	RegisterHandlers(&mux, s)
	return &mux
}

// RegisterHandlers registers all of the method handlers for the specified
// service implementation into the passed ServeMux.
func RegisterHandlers(mux *varlink.ServeMux, s Service) {
	mux.HandleFunc("org.varlink.service.GetInfo", func(w varlink.ReplyWriter, call *varlink.Call) {
		var (
			input  GetInfoInput
			output GetInfoOutput
		)

		if err := call.Unmarshal(&input); err != nil {
			w.WriteError(err)
			return
		}

		validate := func() varlink.Error {

			return nil
		}
		if err := validate(); err != nil {
			w.WriteError(err)
			return
		}

		var err varlink.Error
		output.Vendor, output.Product, output.Version, output.Url, output.Interfaces, err = s.GetInfo(w.Context())
		if err != nil {
			w.WriteError(err)
			return
		}

		w.WriteReply(&output)
	})
	mux.HandleFunc("org.varlink.service.GetInterfaceDescription", func(w varlink.ReplyWriter, call *varlink.Call) {
		var (
			input  GetInterfaceDescriptionInput
			output GetInterfaceDescriptionOutput
		)

		if err := call.Unmarshal(&input); err != nil {
			w.WriteError(err)
			return
		}

		validate := func() varlink.Error {

			return nil
		}
		if err := validate(); err != nil {
			w.WriteError(err)
			return
		}

		var err varlink.Error
		output.Description, err = s.GetInterfaceDescription(w.Context(), input.Interface)
		if err != nil {
			w.WriteError(err)
			return
		}

		w.WriteReply(&output)
	})
}

// Definition contains the definition of the varlink interface which was parsed from its description.
var Definition = syntax.InterfaceDef{Node: syntax.Node{Position: syntax.Cursor{Line: 3, Column: 1}, Comments: []syntax.Token{syntax.Token{Type: "<comment>", Raw: "# The Varlink Service Interface is provided by every varlink service. It\n", Value: "The Varlink Service Interface is provided by every varlink service. It", Start: syntax.Cursor{Line: 1, Column: 1}, End: syntax.Cursor{Line: 1, Column: 73}}, syntax.Token{Type: "<comment>", Raw: "# describes the service and the interfaces it implements.\n", Value: "describes the service and the interfaces it implements.", Start: syntax.Cursor{Line: 2, Column: 1}, End: syntax.Cursor{Line: 2, Column: 58}}}}, Name: "org.varlink.service", Types: []syntax.TypeDef(nil), Methods: []syntax.MethodDef{syntax.MethodDef{Node: syntax.Node{Position: syntax.Cursor{Line: 7, Column: 1}, Comments: []syntax.Token{syntax.Token{Type: "<comment>", Raw: "# Get a list of all the interfaces a service provides and information\n", Value: "Get a list of all the interfaces a service provides and information", Start: syntax.Cursor{Line: 5, Column: 1}, End: syntax.Cursor{Line: 5, Column: 70}}, syntax.Token{Type: "<comment>", Raw: "# about the implementation.\n", Value: "about the implementation.", Start: syntax.Cursor{Line: 6, Column: 1}, End: syntax.Cursor{Line: 6, Column: 28}}}}, Name: "GetInfo", Input: syntax.Struct{Node: syntax.Node{Position: syntax.Cursor{Line: 7, Column: 15}, Comments: []syntax.Token(nil)}, Fields: []syntax.StructField(nil)}, Output: syntax.Struct{Node: syntax.Node{Position: syntax.Cursor{Line: 7, Column: 21}, Comments: []syntax.Token(nil)}, Fields: []syntax.StructField{syntax.StructField{Node: syntax.Node{Position: syntax.Cursor{Line: 8, Column: 3}, Comments: []syntax.Token(nil)}, Name: "vendor", Type: syntax.BuiltinType{Node: syntax.Node{Position: syntax.Cursor{Line: 8, Column: 11}, Comments: []syntax.Token(nil)}, Name: "string"}}, syntax.StructField{Node: syntax.Node{Position: syntax.Cursor{Line: 9, Column: 3}, Comments: []syntax.Token(nil)}, Name: "product", Type: syntax.BuiltinType{Node: syntax.Node{Position: syntax.Cursor{Line: 9, Column: 12}, Comments: []syntax.Token(nil)}, Name: "string"}}, syntax.StructField{Node: syntax.Node{Position: syntax.Cursor{Line: 10, Column: 3}, Comments: []syntax.Token(nil)}, Name: "version", Type: syntax.BuiltinType{Node: syntax.Node{Position: syntax.Cursor{Line: 10, Column: 12}, Comments: []syntax.Token(nil)}, Name: "string"}}, syntax.StructField{Node: syntax.Node{Position: syntax.Cursor{Line: 11, Column: 3}, Comments: []syntax.Token(nil)}, Name: "url", Type: syntax.BuiltinType{Node: syntax.Node{Position: syntax.Cursor{Line: 11, Column: 8}, Comments: []syntax.Token(nil)}, Name: "string"}}, syntax.StructField{Node: syntax.Node{Position: syntax.Cursor{Line: 12, Column: 3}, Comments: []syntax.Token(nil)}, Name: "interfaces", Type: syntax.ArrayType{Node: syntax.Node{Position: syntax.Cursor{Line: 12, Column: 15}, Comments: []syntax.Token(nil)}, ElemType: syntax.BuiltinType{Node: syntax.Node{Position: syntax.Cursor{Line: 12, Column: 17}, Comments: []syntax.Token(nil)}, Name: "string"}}}}}}, syntax.MethodDef{Node: syntax.Node{Position: syntax.Cursor{Line: 16, Column: 1}, Comments: []syntax.Token{syntax.Token{Type: "<comment>", Raw: "# Get the description of an interface that is implemented by this service.\n", Value: "Get the description of an interface that is implemented by this service.", Start: syntax.Cursor{Line: 15, Column: 1}, End: syntax.Cursor{Line: 15, Column: 75}}}}, Name: "GetInterfaceDescription", Input: syntax.Struct{Node: syntax.Node{Position: syntax.Cursor{Line: 16, Column: 31}, Comments: []syntax.Token(nil)}, Fields: []syntax.StructField{syntax.StructField{Node: syntax.Node{Position: syntax.Cursor{Line: 16, Column: 32}, Comments: []syntax.Token(nil)}, Name: "interface", Type: syntax.BuiltinType{Node: syntax.Node{Position: syntax.Cursor{Line: 16, Column: 43}, Comments: []syntax.Token(nil)}, Name: "string"}}}}, Output: syntax.Struct{Node: syntax.Node{Position: syntax.Cursor{Line: 16, Column: 54}, Comments: []syntax.Token(nil)}, Fields: []syntax.StructField{syntax.StructField{Node: syntax.Node{Position: syntax.Cursor{Line: 16, Column: 55}, Comments: []syntax.Token(nil)}, Name: "description", Type: syntax.BuiltinType{Node: syntax.Node{Position: syntax.Cursor{Line: 16, Column: 68}, Comments: []syntax.Token(nil)}, Name: "string"}}}}}}, Errors: []syntax.ErrorDef{syntax.ErrorDef{Node: syntax.Node{Position: syntax.Cursor{Line: 19, Column: 1}, Comments: []syntax.Token{syntax.Token{Type: "<comment>", Raw: "# The requested interface was not found.\n", Value: "The requested interface was not found.", Start: syntax.Cursor{Line: 18, Column: 1}, End: syntax.Cursor{Line: 18, Column: 41}}}}, Name: "InterfaceNotFound", Params: syntax.Struct{Node: syntax.Node{Position: syntax.Cursor{Line: 19, Column: 25}, Comments: []syntax.Token(nil)}, Fields: []syntax.StructField{syntax.StructField{Node: syntax.Node{Position: syntax.Cursor{Line: 19, Column: 26}, Comments: []syntax.Token(nil)}, Name: "interface", Type: syntax.BuiltinType{Node: syntax.Node{Position: syntax.Cursor{Line: 19, Column: 37}, Comments: []syntax.Token(nil)}, Name: "string"}}}}}, syntax.ErrorDef{Node: syntax.Node{Position: syntax.Cursor{Line: 22, Column: 1}, Comments: []syntax.Token{syntax.Token{Type: "<comment>", Raw: "# The requested method was not found\n", Value: "The requested method was not found", Start: syntax.Cursor{Line: 21, Column: 1}, End: syntax.Cursor{Line: 21, Column: 37}}}}, Name: "MethodNotFound", Params: syntax.Struct{Node: syntax.Node{Position: syntax.Cursor{Line: 22, Column: 22}, Comments: []syntax.Token(nil)}, Fields: []syntax.StructField{syntax.StructField{Node: syntax.Node{Position: syntax.Cursor{Line: 22, Column: 23}, Comments: []syntax.Token(nil)}, Name: "method", Type: syntax.BuiltinType{Node: syntax.Node{Position: syntax.Cursor{Line: 22, Column: 31}, Comments: []syntax.Token(nil)}, Name: "string"}}}}}, syntax.ErrorDef{Node: syntax.Node{Position: syntax.Cursor{Line: 26, Column: 1}, Comments: []syntax.Token{syntax.Token{Type: "<comment>", Raw: "# The interface defines the requested method, but the service does not\n", Value: "The interface defines the requested method, but the service does not", Start: syntax.Cursor{Line: 24, Column: 1}, End: syntax.Cursor{Line: 24, Column: 71}}, syntax.Token{Type: "<comment>", Raw: "# implement it.\n", Value: "implement it.", Start: syntax.Cursor{Line: 25, Column: 1}, End: syntax.Cursor{Line: 25, Column: 16}}}}, Name: "MethodNotImplemented", Params: syntax.Struct{Node: syntax.Node{Position: syntax.Cursor{Line: 26, Column: 28}, Comments: []syntax.Token(nil)}, Fields: []syntax.StructField{syntax.StructField{Node: syntax.Node{Position: syntax.Cursor{Line: 26, Column: 29}, Comments: []syntax.Token(nil)}, Name: "method", Type: syntax.BuiltinType{Node: syntax.Node{Position: syntax.Cursor{Line: 26, Column: 37}, Comments: []syntax.Token(nil)}, Name: "string"}}}}}, syntax.ErrorDef{Node: syntax.Node{Position: syntax.Cursor{Line: 29, Column: 1}, Comments: []syntax.Token{syntax.Token{Type: "<comment>", Raw: "# One of the passed parameters is invalid.\n", Value: "One of the passed parameters is invalid.", Start: syntax.Cursor{Line: 28, Column: 1}, End: syntax.Cursor{Line: 28, Column: 43}}}}, Name: "InvalidParameter", Params: syntax.Struct{Node: syntax.Node{Position: syntax.Cursor{Line: 29, Column: 24}, Comments: []syntax.Token(nil)}, Fields: []syntax.StructField{syntax.StructField{Node: syntax.Node{Position: syntax.Cursor{Line: 29, Column: 25}, Comments: []syntax.Token(nil)}, Name: "parameter", Type: syntax.BuiltinType{Node: syntax.Node{Position: syntax.Cursor{Line: 29, Column: 36}, Comments: []syntax.Token(nil)}, Name: "string"}}}}}, syntax.ErrorDef{Node: syntax.Node{Position: syntax.Cursor{Line: 32, Column: 1}, Comments: []syntax.Token{syntax.Token{Type: "<comment>", Raw: "# Client is denied access\n", Value: "Client is denied access", Start: syntax.Cursor{Line: 31, Column: 1}, End: syntax.Cursor{Line: 31, Column: 26}}}}, Name: "PermissionDenied", Params: syntax.Struct{Node: syntax.Node{Position: syntax.Cursor{Line: 32, Column: 24}, Comments: []syntax.Token(nil)}, Fields: []syntax.StructField(nil)}}, syntax.ErrorDef{Node: syntax.Node{Position: syntax.Cursor{Line: 35, Column: 1}, Comments: []syntax.Token{syntax.Token{Type: "<comment>", Raw: "# Method is expected to be called with 'more' set to true, but wasn't\n", Value: "Method is expected to be called with 'more' set to true, but wasn't", Start: syntax.Cursor{Line: 34, Column: 1}, End: syntax.Cursor{Line: 34, Column: 70}}}}, Name: "ExpectedMore", Params: syntax.Struct{Node: syntax.Node{Position: syntax.Cursor{Line: 35, Column: 20}, Comments: []syntax.Token(nil)}, Fields: []syntax.StructField(nil)}}}}

// Description contains the description of the varlink interface, expressed in the IDL.
var Description = `# The Varlink Service Interface is provided by every varlink service. It
# describes the service and the interfaces it implements.
interface org.varlink.service

# Get a list of all the interfaces a service provides and information
# about the implementation.
method GetInfo() -> (
  vendor: string,
  product: string,
  version: string,
  url: string,
  interfaces: []string
)

# Get the description of an interface that is implemented by this service.
method GetInterfaceDescription(interface: string) -> (description: string)

# The requested interface was not found.
error InterfaceNotFound (interface: string)

# The requested method was not found
error MethodNotFound (method: string)

# The interface defines the requested method, but the service does not
# implement it.
error MethodNotImplemented (method: string)

# One of the passed parameters is invalid.
error InvalidParameter (parameter: string)

# Client is denied access
error PermissionDenied ()

# Method is expected to be called with 'more' set to true, but wasn't
error ExpectedMore ()
`
